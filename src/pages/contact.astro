---
// src/pages/contact.astro
import BaseLayout from "@/layouts/BaseLayout.astro";
import { buttonVariants } from "@/components/ui/button";
// Note: The original index page had commented-out imports for UI components.
// If the form styling relies on these or specific CSS classes from them,
// they might need to be re-imported or the classes adjusted.
// For now, we'll use the existing HTML structure and classes.
---

<BaseLayout
  title="Contact Us | Lethbridge Drone Services | Coalbanks Creative"
  description="Ready to chat about drone photos or video in Lethbridge? Contact Coalbanks Creative! Get your free, no-obligation quote today for professional aerial services."
>
  <main class="flex flex-col gap-y-20 md:gap-y-32 overflow-x-hidden">
    <section id="contact" class="container py-16 md:py-24">
      {/* Apply consistent H1 style */}
      <h1 class="font-heading text-4xl md:text-5xl font-bold text-center mb-12 tracking-tight">Get in Touch! Let's Talk Drones</h1>
      <p class="text-lg text-muted-foreground leading-relaxed mb-8 max-w-xl mx-auto text-center">
        Have a great idea for some drone shots? Curious how aerial views could help your Lethbridge business or project? We're all ears! Fill out this quick form, or feel free to call or email. We're happy to answer questions and give you a free, no-pressure quote.
      </p>
      {/* Added relative, padding, rounded, bg, overflow-hidden */}
      <form id="contact-form" method="POST" action="/api/submit" class="relative max-w-xl mx-auto grid gap-6 p-6 md:p-8 rounded-lg bg-card/90 dark:bg-card/80 overflow-hidden">
        {/* Add topography SVG background */}
        <div class="absolute inset-0 -z-10 size-full bg-[url('/images/assets/topography.svg')] bg-repeat opacity-30 dark:invert" />
        {/* Form fields remain above the background */}
        <div class="grid gap-2">
          <label for="name" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50">Your Name</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Your Name"
            required
            class="border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex h-9 w-full rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
          />
        </div>
        <div class="grid gap-2">
          <label for="email" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50">Your Email</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="your@email.com"
            required
            class="border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex h-9 w-full rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
          />
        </div>
        <div class="grid gap-2">
          <label for="phone" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50">Phone Number (Optional)</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            placeholder="Your Phone Number"
            class="border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex h-9 w-full rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
          />
        </div>
        <div class="grid gap-2">
          <label for="service-needed" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50">What Service Are You Interested In? (Optional)</label>
          <select
            id="service-needed"
            name="service-needed"
            class="border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex h-9 w-full rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
          >
            <option value="" disabled selected>Choose one (or 'Other')...</option>
            {/* Updated option text to match Services page */}
            <option value="Showcase Properties from Above">Showcase Properties from Above</option>
            <option value="Marketing Videos with Altitude">Marketing Videos with Altitude</option>
            <option value="Dynamic Event Coverage">Dynamic Event Coverage</option>
            <option value="Construction Site Fly-Overs">Construction Site Fly-Overs</option>
            <option value="Precise Mapping & Surveys">Precise Mapping & Surveys</option>
            <option value="Ag Insights for Smart Farming">Ag Insights for Smart Farming</option>
            <option value="Other">Something Else / Not Sure Yet</option>
          </select>
        </div>
        <div class="grid gap-2">
          <label for="project-location" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50">Where's the Project? (Approx. Location, Optional)</label>
          <input
            type="text"
            id="project-location"
            name="project-location"
            placeholder="e.g., Lethbridge North, Taber Area"
            class="border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex h-9 w-full rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
          />
        </div>
        <div class="grid gap-2">
          <label for="message" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50">Your Message / Project Details</label>
          <textarea
            id="message"
            name="message"
            placeholder="Tell us a bit about your project, timeline, or any questions you have..."
            rows={5}
            required
            class="border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
          ></textarea>
        </div>
        <div id="form-status" class="text-sm font-medium"></div> {/* Element to display success/error messages */}
        <button
          type="submit"
          id="submit-button"
          class={buttonVariants({ size: "lg" })}
        >
          Send My Message!
        </button>
      </form>
    </section>

    {/* Add script for form submission handling */}
    <script>
      const form = document.getElementById('contact-form') as HTMLFormElement;
      const statusDiv = document.getElementById('form-status') as HTMLDivElement;
      const submitButton = document.getElementById('submit-button') as HTMLButtonElement;

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        submitButton.disabled = true;
        submitButton.textContent = 'Sending...';
        statusDiv.textContent = ''; // Clear previous status

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
          const response = await fetch('/api/submit', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            const result = await response.json();
            statusDiv.textContent = 'Success! Your message has been sent.';
            statusDiv.style.color = 'green';
            form.reset(); // Clear the form
          } else {
            const errorResult = await response.json();
            statusDiv.textContent = `Error: ${errorResult.message || 'Failed to send message.'}`;
            statusDiv.style.color = 'red';
          }
        } catch (error) {
          console.error('Form submission error:', error);
          statusDiv.textContent = 'An unexpected error occurred. Please try again later.';
          statusDiv.style.color = 'red';
        } finally {
          submitButton.disabled = false;
          submitButton.textContent = 'Send My Message!'; // Keep consistent with initial text
        }
      });
    </script>

  </main>
</BaseLayout>
